var __awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(r,a){function s(t){try{u(n.next(t))}catch(t){a(t)}}function o(t){try{u(n["throw"](t))}catch(t){a(t)}}function u(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(s,o)}u((n=n.apply(t,e||[])).next())})};var __generator=this&&this.__generator||function(t,e){var i={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,r,a,s;return s={next:o(0),throw:o(1),return:o(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function o(t){return function(e){return u([t,e])}}function u(s){if(n)throw new TypeError("Generator is already executing.");while(i)try{if(n=1,r&&(a=s[0]&2?r["return"]:s[0]?r["throw"]||((a=r["return"])&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;if(r=0,a)s=[s[0]&2,a.value];switch(s[0]){case 0:case 1:a=s;break;case 4:i.label++;return{value:s[1],done:false};case 5:i.label++;r=s[1];s=[0];continue;case 7:s=i.ops.pop();i.trys.pop();continue;default:if(!(a=i.trys,a=a.length>0&&a[a.length-1])&&(s[0]===6||s[0]===2)){i=0;continue}if(s[0]===3&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(s[0]===6&&i.label<a[1]){i.label=a[1];a=s;break}if(a&&i.label<a[2]){i.label=a[2];i.ops.push(s);break}if(a[2])i.ops.pop();i.trys.pop();continue}s=e.call(t,i)}catch(t){s=[6,t];r=0}finally{n=a=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};System.register(["./p-8f610639.system.js"],function(t){"use strict";var e,i;return{setters:[function(t){e=t.r;i=t.h}],execute:function(){function n(t){var e=Math.floor(t/60);var i=String(e).padStart(2,"0");var n=Math.floor(t-e*60);var r=String(n).padStart(2,"0");return i+":"+r}function r(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}return t.flatMap(function(t){if(typeof t==="string")return[t];var e=[];for(var i in t){if(t[i])e.push(i)}return e}).join(" ")}function a(t,e,i){var n=t-e.min;var r=e.max-e.min;var a=n/r;var s=i.max-i.min;var o=a*s;return o+i.min}var s=function(){function t(t){this.canvas=t;this.width=t.width;this.height=t.height;this.ctx=t.getContext("2d");this.keyframes=[]}t.prototype.draw=function(){var t=this;this.ctx.clearRect(0,0,this.width,this.width);this.drawLine();for(var e=0,i=this.keyframes;e<i.length;e++){var n=i[e];this.drawKeyframe(n)}requestAnimationFrame(function(){return t.draw()})};t.prototype.handleHover=function(t){var e=this;this.mousePos=t;if(this.draggedId===null)return;this.keyframes=this.sortKeyframes(this.keyframes.map(function(i){return e.draggedId===i.id?Object.assign({},t,{id:i.id}):i}))};t.prototype.onClick=function(t){for(var e=0,i=this.keyframes;e<i.length;e++){var n=i[e];if(this.getDist(t,n)>=8)continue;this.selectedId=this.draggedId=n.id;return}this.addKeyframe(t)};t.prototype.addKeyframe=function(t){var e=Object.assign({},t,{id:Symbol()});this.keyframes=this.sortKeyframes(this.keyframes.concat([e]));this.draggedId=this.selectedId=e.id};t.prototype.onRelease=function(){this.draggedId=null};t.prototype.onDelete=function(){var t=this;if(this.selectedId===null)return;var e=this.getKeyframeIndex(this.selectedId);this.keyframes=this.keyframes.filter(function(e){return e.id!==t.selectedId});if(!this.keyframes.length){this.selectedId=null;return}var i=this.keyframes.length>e?e:e-1;this.selectedId=this.keyframes[i].id};t.prototype.sortKeyframes=function(t){return t.sort(function(t,e){return t.x-e.x})};t.prototype.getKeyframeIndex=function(t){for(var e=0,i=this.keyframes.entries();e<i.length;e++){var n=i[e],r=n[0],a=n[1];if(a.id===t)return r}};t.prototype.drawLine=function(){var t=this.getFullKeyframes();var e=t[0];this.ctx.strokeStyle="#aaa";for(var i=0,n=t.slice(1);i<n.length;i++){var r=n[i];this.ctx.beginPath();this.ctx.moveTo(e.x,e.y);this.ctx.lineTo(r.x,r.y);this.ctx.stroke();e=r}};t.prototype.getFullKeyframes=function(){var t=this.keyframes[0];var e=this.keyframes[this.keyframes.length-1];var i=t?t.y:this.height/2;var n=e?e.y:this.height/2;return[{x:0,y:i,id:Symbol("start")}].concat(this.keyframes,[{x:this.width,y:n,id:Symbol("end")}])};t.prototype.getSurroundingKeyframes=function(t){var e=this.getFullKeyframes();var i=0;for(var n=0,r=e.entries();n<r.length;n++){var a=r[n],s=a[0],o=a[1];if(t<=o.x)break;var u=e[i].x;if(t-o.x<t-u)i=s}return{prev:e[i],next:e[i+1]}};t.prototype.getDist=function(t,e){var i=t.x-e.x;var n=t.y-e.y;return Math.sqrt(Math.pow(i,2)+Math.pow(n,2))};t.prototype.drawKeyframe=function(t){var e=this.getDist(this.mousePos,t)<8;var i=t.id===this.selectedId;this.ctx.beginPath();this.ctx.fillStyle=e?"#444":"grey";this.ctx.arc(t.x,t.y,8,0,2*Math.PI);this.ctx.fill();this.ctx.beginPath();this.ctx.fillStyle=i?"coral":"white";this.ctx.arc(t.x,t.y,4,0,2*Math.PI);this.ctx.fill()};return t}();var o=function(){function t(t){var i=this;e(this,t);this.isCollapsed=false;this.canvasClick=function(t){i.canvas.onClick(i.getPos(t))};this.canvasRelease=function(){i.canvas.onRelease()};this.handleHover=function(t){i.canvas.handleHover(i.getPos(t))};this.handleKeyPress=function(t){if(t.key!=="Backspace"&&t.key!=="Delete")return;i.canvas.onDelete()};this.getPos=function(t){var e=t.target.getBoundingClientRect(),i=e.x,n=e.y;return{x:~~(t.clientX-i),y:~~(t.clientY-n)}};this.collapseToggle=function(){i.isCollapsed=!i.isCollapsed}}t.prototype.getHeightPercentage=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,n,r,s,o;return __generator(this,function(u){e=this.canvasElement.width*t;i=this.canvas.getSurroundingKeyframes(e),n=i.prev,r=i.next;s=a(e,{min:n.x,max:r.x},{min:n.y,max:r.y});o=s/this.canvasElement.height;return[2,1-o]})})};t.prototype.componentDidLoad=function(){var t=this.canvasContainer.getBoundingClientRect(),e=t.width,i=t.height;this.canvasElement.width=e;this.canvasElement.height=i;window.addEventListener("keydown",this.handleKeyPress);this.canvas=new s(this.canvasElement);this.canvas.draw()};t.prototype.render=function(){var t=this;return i("div",{class:r("keyframe-editor",{collapsed:this.isCollapsed})},i("div",{class:r("canvas-container",{collapsed:this.isCollapsed}),ref:function(e){return t.canvasContainer=e}},i("canvas",{ref:function(e){return t.canvasElement=e},onMouseDown:this.canvasClick,onMouseUp:this.canvasRelease,onMouseMove:this.handleHover})),i("div",{class:r("expand-contract-toggle",{collapsed:this.isCollapsed}),onClick:this.collapseToggle},i("span",null,"<")))};Object.defineProperty(t,"style",{get:function(){return".keyframe-editor{--canvas-height:50px;--btn-height:10px;height:calc(var(--canvas-height) + var(--btn-height));cursor:pointer;-webkit-transition:.5s;transition:.5s}.keyframe-editor.collapsed{height:10px}.canvas-container{height:var(--canvas-height);overflow:hidden;background:#e2e2e2;-webkit-transition:.5s;transition:.5s}.canvas-container.collapsed{height:0}.expand-contract-toggle{height:var(--btn-height);background:#20212c;display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center}.expand-contract-toggle span{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;display:block;-webkit-transform:rotate(90deg) scaleX(.5);transform:rotate(90deg) scaleX(.5);-webkit-transition:.5s;transition:.5s}.expand-contract-toggle.collapsed span{-webkit-transform:rotate(90deg) scaleX(-.5);transform:rotate(90deg) scaleX(-.5)}"},enumerable:true,configurable:true});return t}();t("keyframe_editor",o);var u=function(){function t(t){var i=this;e(this,t);this.isPlaying=true;this.currentTime=0;this.duration=0;this.updateTime=function(){i.currentTime=i.audioFile.currentTime};this.updateVolume=function(){return __awaiter(i,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:t=this.currentTime/this.duration;return[4,this.keyframeEditor.getHeightPercentage(t)];case 1:e=i.sent();this.audioFile.volume=e;return[2]}})})};this.togglePlay=function(){if(!i.audioFile)return;i.audioFile[i.isPlaying?"play":"pause"]();i.isPlaying=!i.isPlaying};this.handleTimeSeek=function(t){var e=t.target.className==="progress-bar"?t.target.parentElement:t.target;var n=e.getBoundingClientRect(),r=n.x,a=n.width;var s=(t.x-r)/a;i.audioFile.currentTime=s*i.duration};this.getTime=function(){return n(i.currentTime)+" / "+n(i.duration)};this.getWidth=function(){return i.currentTime/i.duration*100+"%"}}t.prototype.componentDidUpdate=function(){if(!this.audioFile||this.audioFile.src!==this.url)this.initializeAudio()};t.prototype.initializeAudio=function(){var t=this;this.audioFile=new Audio(this.url);this.audioFile.addEventListener("timeupdate",function(){t.updateTime();t.updateVolume()});this.audioFile.addEventListener("ended",this.togglePlay);this.audioFile.addEventListener("loadeddata",function(){return t.duration=t.audioFile.duration})};t.prototype.render=function(){var t=this;return i("div",{class:"audioplayer"},i("div",{class:"timeline",onClick:this.handleTimeSeek},i("div",{class:"progress-bar",style:{width:this.getWidth()}})),i("div",{class:"body"},i("div",{class:"play-container"+(!this.audioFile?" disabled":"")},i("div",{class:(this.isPlaying?"play":"pause")+" btn",onClick:this.togglePlay})),i("div",{class:"name"},this.name||"Unknown Song"),i("div",{class:"time"},this.getTime())),i("keyframe-editor",{ref:function(e){return t.keyframeEditor=e},open:true}))};Object.defineProperty(t,"style",{get:function(){return".audioplayer{height:50px;font-family:Arial,Helvetica,sans-serif;background:#223143;color:#fff;display:grid;grid-template-rows:auto 40px 1fr}.timeline{cursor:pointer;height:10px;background:#e2e2e2}.progress-bar{height:100%;width:0;background:coral;-webkit-transition:.5s;transition:.5s}.body{display:grid;grid-template-columns:auto 1fr auto;grid-gap:10px;-ms-flex-line-pack:center;align-content:center}.body>*{padding:5px 20px;display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center}.name{text-align:center}.btn{cursor:pointer}.play-container{width:20px}.play-container.disabled{opacity:.5}.play-container.disabled .btn{cursor:auto}.play{border:7px solid transparent;border-left:12px solid #fff;position:relative;right:-4px}.pause:after,.pause:before{content:\"\";position:absolute;width:3px;top:0;bottom:0;background:#fff}.pause{height:13px;width:11px;position:relative}.pause:before{left:0}.pause:after{right:0}"},enumerable:true,configurable:true});return t}();t("keyframed_audio_player",u)}}});