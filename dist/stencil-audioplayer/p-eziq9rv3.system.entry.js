var __awaiter=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(r,a){function s(e){try{u(n.next(e))}catch(e){a(e)}}function o(e){try{u(n["throw"](e))}catch(e){a(e)}}function u(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(s,o)}u((n=n.apply(e,t||[])).next())})};var __generator=this&&this.__generator||function(e,t){var i={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,r,a,s;return s={next:o(0),throw:o(1),return:o(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function o(e){return function(t){return u([e,t])}}function u(s){if(n)throw new TypeError("Generator is already executing.");while(i)try{if(n=1,r&&(a=s[0]&2?r["return"]:s[0]?r["throw"]||((a=r["return"])&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;if(r=0,a)s=[s[0]&2,a.value];switch(s[0]){case 0:case 1:a=s;break;case 4:i.label++;return{value:s[1],done:false};case 5:i.label++;r=s[1];s=[0];continue;case 7:s=i.ops.pop();i.trys.pop();continue;default:if(!(a=i.trys,a=a.length>0&&a[a.length-1])&&(s[0]===6||s[0]===2)){i=0;continue}if(s[0]===3&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(s[0]===6&&i.label<a[1]){i.label=a[1];a=s;break}if(a&&i.label<a[2]){i.label=a[2];i.ops.push(s);break}if(a[2])i.ops.pop();i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e];r=0}finally{n=a=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};System.register(["./p-7cf8e818.system.js"],function(e){"use strict";var t,i;return{setters:[function(e){t=e.r;i=e.h}],execute:function(){function n(e){var t=Math.floor(e/60);var i=String(t).padStart(2,"0");var n=Math.floor(e-t*60);var r=String(n).padStart(2,"0");return i+":"+r}function r(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return e.flatMap(function(e){if(typeof e==="string")return[e];var t=[];for(var i in e){if(e[i])t.push(i)}return t}).join(" ")}function a(e,t,i){if(t.max-t.min===0)return;var n=e-t.min;var r=t.max-t.min;var a=n/r;var s=i.max-i.min;var o=a===Infinity?.5:a;var u=o*s;return u+i.min}var s=function(){function e(e){this.canvas=e;this.width=e.width;this.height=e.height;this.ctx=e.getContext("2d");this.keyframes=[]}e.prototype.draw=function(){var e=this;this.ctx.clearRect(0,0,this.width,this.width);this.drawLine();for(var t=0,i=this.keyframes;t<i.length;t++){var n=i[t];this.drawKeyframe(n)}requestAnimationFrame(function(){return e.draw()})};e.prototype.handleHover=function(e){var t=this;this.mousePos=e;if(this.draggedId===null)return;if(this.isColliding(Object.assign({},e,{id:this.draggedId})))return;this.keyframes=this.sortKeyframes(this.keyframes.map(function(i){return t.draggedId===i.id?Object.assign({},e,{id:i.id}):i}))};e.prototype.onClick=function(e){for(var t=0,i=this.keyframes;t<i.length;t++){var n=i[t];if(this.getDist(e,n)>=8)continue;this.selectedId=this.draggedId=n.id;return}this.addKeyframe(e)};e.prototype.addKeyframe=function(e){var t=Object.assign({},e,{id:Symbol()});this.keyframes=this.sortKeyframes(this.keyframes.concat([t]));this.draggedId=this.selectedId=t.id};e.prototype.onRelease=function(){this.draggedId=null};e.prototype.onDelete=function(){var e=this;if(this.selectedId===null)return;var t=this.getKeyframeIndex(this.selectedId);this.keyframes=this.keyframes.filter(function(t){return t.id!==e.selectedId});if(!this.keyframes.length){this.selectedId=null;return}var i=this.keyframes.length>t?t:t-1;this.selectedId=this.keyframes[i].id};e.prototype.sortKeyframes=function(e){return e.sort(function(e,t){return e.x-t.x})};e.prototype.getKeyframeIndex=function(e){for(var t=0,i=this.keyframes.entries();t<i.length;t++){var n=i[t],r=n[0],a=n[1];if(a.id===e)return r}};e.prototype.hasSelected=function(){return this.selectedId!==null};e.prototype.deselect=function(){this.selectedId=null};e.prototype.drawLine=function(){var e=this.getFullKeyframes();var t=e[0];this.ctx.strokeStyle="#aaa";for(var i=0,n=e.slice(1);i<n.length;i++){var r=n[i];this.ctx.beginPath();this.ctx.moveTo(t.x,t.y);this.ctx.lineTo(r.x,r.y);this.ctx.stroke();t=r}};e.prototype.getFullKeyframes=function(){var e=this.keyframes[0];var t=this.keyframes[this.keyframes.length-1];var i=e?e.y:this.height/2;var n=t?t.y:this.height/2;return[{x:0,y:i,id:Symbol("start")}].concat(this.keyframes,[{x:this.width,y:n,id:Symbol("end")}])};e.prototype.getSurroundingKeyframes=function(e){var t=this.getFullKeyframes();var i=0;for(var n=0,r=t.entries();n<r.length;n++){var a=r[n],s=a[0],o=a[1];if(e<=o.x)break;var u=t[i].x;if(e-o.x<e-u)i=s}return{prev:t[i],next:t[i+1]}};e.prototype.getDist=function(e,t){var i=e.x-t.x;var n=e.y-t.y;return Math.sqrt(Math.pow(i,2)+Math.pow(n,2))};e.prototype.isColliding=function(e){return this.keyframes.some(function(t){return Math.abs(e.x-t.x)<2&&e.id!==t.id})};e.prototype.drawKeyframe=function(e){var t=this.getDist(this.mousePos,e)<8;var i=e.id===this.selectedId;this.ctx.beginPath();this.ctx.fillStyle=t?"#444":"grey";this.ctx.arc(e.x,e.y,8,0,2*Math.PI);this.ctx.fill();this.ctx.beginPath();this.ctx.fillStyle=i?"coral":"white";this.ctx.arc(e.x,e.y,4,0,2*Math.PI);this.ctx.fill()};return e}();var o=e("keyframe_editor",function(){function e(e){var i=this;t(this,e);this.isCollapsed=false;this.canvasClicked=false;this.canvasClick=function(e){i.canvas.onClick(i.getPos(e));i.canvasClicked=true;setTimeout(function(){return i.canvasClicked=false},0)};this.canvasRelease=function(){i.canvas.onRelease()};this.deselect=function(){if(i.canvasClicked||!i.canvas.hasSelected())return;i.canvas.deselect()};this.handleHover=function(e){i.canvas.handleHover(i.getPos(e))};this.handleKeyPress=function(e){if(e.key!=="Backspace"&&e.key!=="Delete")return;i.canvas.onDelete()};this.getPos=function(e){var t=e.target.getBoundingClientRect(),i=t.x,n=t.y;return{x:~~(e.clientX-i),y:~~(e.clientY-n)}};this.collapseToggle=function(){i.isCollapsed=!i.isCollapsed}}e.prototype.getHeightPercentage=function(e){return __awaiter(this,void 0,void 0,function(){var t,i,n,r,s,o;return __generator(this,function(u){t=this.canvasElement.width*e;i=this.canvas.getSurroundingKeyframes(t),n=i.prev,r=i.next;s=a(t,{min:n.x,max:r.x},{min:n.y,max:r.y});o=s/this.canvasElement.height;return[2,1-o]})})};e.prototype.componentDidLoad=function(){var e=this.canvasContainer.getBoundingClientRect(),t=e.width,i=e.height;this.canvasElement.width=t;this.canvasElement.height=i;window.addEventListener("keydown",this.handleKeyPress);window.addEventListener("mousedown",this.deselect);this.canvas=new s(this.canvasElement);this.canvas.draw()};e.prototype.render=function(){var e=this;return i("div",{class:r("keyframe-editor",{collapsed:this.isCollapsed})},i("div",{class:r("canvas-container",{collapsed:this.isCollapsed}),ref:function(t){return e.canvasContainer=t}},i("canvas",{ref:function(t){return e.canvasElement=t},onMouseDown:this.canvasClick,onMouseUp:this.canvasRelease,onMouseMove:this.handleHover})),i("div",{class:r("expand-contract-toggle",{collapsed:this.isCollapsed}),onClick:this.collapseToggle},i("div",{class:"name"},this.name||""),i("div",{class:"icon"},i("span",null,"<"))))};Object.defineProperty(e,"style",{get:function(){return".keyframe-editor{--canvas-height:50px;--btn-height:10px;height:calc(var(--canvas-height) + var(--btn-height));cursor:pointer;-webkit-transition:.5s;transition:.5s;position:relative}.keyframe-editor.collapsed{height:10px}.canvas-container{height:var(--canvas-height);overflow:hidden;background:#e2e2e2;-webkit-transition:.5s;transition:.5s}.canvas-container.collapsed{height:0}.expand-contract-toggle>*{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;height:var(--btn-height)}.expand-contract-toggle{background:#20212c;display:grid;grid-template-columns:20px 1fr;-ms-flex-line-pack:center;align-content:center;padding:0 8px}.expand-contract-toggle .icon{display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center}.expand-contract-toggle .icon span{-webkit-transform:rotate(90deg) scaleX(.5);transform:rotate(90deg) scaleX(.5);-webkit-transition:.5s;transition:.5s}.expand-contract-toggle.collapsed .icon span{-webkit-transform:rotate(90deg) scaleX(-.5);transform:rotate(90deg) scaleX(-.5)}.expand-contract-toggle .name{color:hsla(0,0%,100%,.4);font-size:9px}"},enumerable:true,configurable:true});return e}());var u=function(){function e(e){this.audio=new Audio(e);var t=AudioContext;this.audioContext=new t;this.track=this.audioContext.createMediaElementSource(this.audio);this.gainNode=this.audioContext.createGain();this.gainNode.gain.value=.5;this.panner=new StereoPannerNode(this.audioContext,{pan:0});this.track.connect(this.gainNode).connect(this.panner).connect(this.audioContext.destination)}e.prototype.reInit=function(e){if(e===this.audio.src)return;this.audio.src=e;this.audio.currentTime=0;this.audio.pause()};e.prototype.togglePlayer=function(){if(this.audioContext.state==="suspended"){this.audioContext.resume()}var e=this.audio.paused;this.audio[e?"play":"pause"]();return!e};e.prototype.reset=function(){this.audio.currentTime=0;this.audio.pause()};Object.defineProperty(e.prototype,"currentTime",{get:function(){return this.audio.currentTime},set:function(e){this.audio.currentTime=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"volume",{set:function(e){this.gainNode.gain.value=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"pan",{set:function(e){this.panner.pan.value=a(e,{min:0,max:1},{min:-1,max:1})},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"duration",{get:function(){return this.audio.duration},enumerable:true,configurable:true});return e}();var c=e("keyframed_audio_player",function(){function e(e){var i=this;t(this,e);this.isPaused=true;this.currentTime=0;this.duration=0;this.updateTime=function(){i.currentTime=i.audioContainer.currentTime};this.updatePan=function(){return __awaiter(i,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:e=this.currentTime/this.duration;return[4,this.keyframeEditorPan.getHeightPercentage(e)];case 1:t=i.sent();this.audioContainer.pan=t;return[2]}})})};this.updateVolume=function(){return __awaiter(i,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:e=this.currentTime/this.duration;return[4,this.keyframeEditorVolume.getHeightPercentage(e)];case 1:t=i.sent();this.audioContainer.volume=t;return[2]}})})};this.togglePlay=function(){if(!i.url)return;i.isPaused=i.audioContainer.togglePlayer()};this.handleTimeSeek=function(e){var t=e.target.className==="progress-bar"?e.target.parentElement:e.target;var n=t.getBoundingClientRect(),r=n.x,a=n.width;var s=(e.x-r)/a;i.audioContainer.currentTime=s*i.duration};this.getTime=function(){return n(i.currentTime)+" / "+n(i.duration)};this.getWidth=function(){return i.currentTime/i.duration*100+"%"}}e.prototype.componentDidLoad=function(){var e=this;this.audioContainer=new u(this.url);this.audioContainer.audio.addEventListener("loadeddata",function(){e.duration=e.audioContainer.duration});this.audioContainer.audio.addEventListener("ended",function(){e.audioContainer.reset();e.isPaused=true});this.audioContainer.audio.addEventListener("timeupdate",function(){e.updateTime();e.updatePan();if(!e.isPaused)e.updateVolume()})};e.prototype.componentDidUpdate=function(){this.audioContainer.reInit(this.url)};e.prototype.render=function(){var e=this;return i("div",{class:"audioplayer"},i("div",{class:"timeline",onClick:this.handleTimeSeek},i("div",{class:"progress-bar",style:{width:this.getWidth()}})),i("div",{class:"body"},i("div",{class:"play-container"+(!this.url?" disabled":"")},i("div",{class:(this.isPaused?"play":"pause")+" btn",onClick:this.togglePlay})),i("div",{class:"name"},this.name||"Unknown Song"),i("div",{class:"time"},this.getTime())),i("keyframe-editor",{ref:function(t){return e.keyframeEditorVolume=t},open:true,name:"volume"}),i("keyframe-editor",{ref:function(t){return e.keyframeEditorPan=t},open:true,name:"pan"}))};Object.defineProperty(e,"style",{get:function(){return".audioplayer{height:50px;font-family:Arial,Helvetica,sans-serif;background:#223143;color:#fff;position:relative;z-index:2;display:grid;grid-template-rows:auto 40px 1fr}.timeline{cursor:pointer;height:10px;background:#e2e2e2}.progress-bar{height:100%;width:0;background:coral;-webkit-transition:.5s;transition:.5s}.body{display:grid;grid-template-columns:auto 1fr auto;grid-gap:10px;-ms-flex-line-pack:center;align-content:center}.body>*{padding:5px 20px;display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center}.name{text-align:center}.btn{cursor:pointer}.play-container{width:20px}.play-container.disabled{opacity:.5}.play-container.disabled .btn{cursor:auto}.play{border:7px solid transparent;border-left:12px solid #fff;position:relative;right:-4px}.pause:after,.pause:before{content:\"\";position:absolute;width:3px;top:0;bottom:0;background:#fff}.pause{height:13px;width:11px;position:relative}.pause:before{left:0}.pause:after{right:0}"},enumerable:true,configurable:true});return e}())}}});